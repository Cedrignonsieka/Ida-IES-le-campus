<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Mini Réseau Social</title>
</head>
<body>
  <h1>Mini Réseau Social</h1>

  <!-- Login -->
  <h2>Connexion</h2>
  <input type="text" id="email" placeholder="Email"><br>
  <input type="password" id="password" placeholder="Mot de passe"><br>
  <button onclick="login()">Se connecter</button>
  <p id="loginMessage"></p>

  <!-- Publier un post -->
  <h2>Publier</h2>
  <input type="text" id="author" placeholder="Auteur"><br>
  <textarea id="content" placeholder="Écris ton message..."></textarea><br>
  <button onclick="publishPost()">Publier</button>
  <p id="postMessage"></p>

  <!-- Afficher les posts -->
  <h2>Posts</h2>
  <div id="posts"></div>

  <script>
    const backendURL = "https://ieslecampus.onrender.com"; // Ton backend Render

    async function login() {
      const email = document.getElementById("email").value;
      const password = document.getElementById("password").value;

      const res = await fetch(`${backendURL}/login`, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ email, password })
      });

      const data = await res.json();
      document.getElementById("loginMessage").innerText = data.message;
    }

    async function publishPost() {
      const author = document.getElementById("author").value;
      const content = document.getElementById("content").value;

      const res = await fetch(`${backendURL}/posts`, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ author, content })
      });

      const data = await res.json();
      document.getElementById("postMessage").innerText = data.message;
      loadPosts();
    }

    async function loadPosts() {
      const res = await fetch(`${backendURL}/posts`);
      const posts = await res.json();

      const postsDiv = document.getElementById("posts");
      postsDiv.innerHTML = posts.map(p => `<p><b>${p.author}:</b> ${p.content}</p>`).join("");
    }

    loadPosts();
  </script>
</body>
</html>
