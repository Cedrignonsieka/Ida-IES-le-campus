<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>IES Le Campus</title>
  <style>
    :root{
      --brand:#4267B2;
      --brand-dark:#365899;
      --cta:#42b72a;
      --cta-dark:#36a420;
      --header-h:64px;
    }

    /* ===== Base & Background ===== */
    html,body{
      height:100%;
      margin:0;
      font-family: Arial, sans-serif;
      color:#111;
      background: #f0f2f5;
    }
    body::before{
      content:"";
      position:fixed;
      inset:0;
      background:url("im.jpg") no-repeat center center / cover;
      z-index:-2;
    }
    /* voile pour lisibilité */
    body::after{
      content:"";
      position:fixed;
      inset:0;
      background: rgba(0,0,0,.25);
      z-index:-1;
    }

    /* ===== Header (fixe, ne bouge pas) ===== */
    header{
      position:fixed;
      top:0; left:0; right:0;
      height:var(--header-h);
      background: rgba(66,103,178,0.96);
      backdrop-filter: blur(6px);
      display:flex;
      align-items:center;
      justify-content:flex-end; /* le menu est à droite */
      padding: 0 16px;
      box-shadow: 0 2px 10px rgba(0,0,0,.18);
      z-index:1000;
    }

    /* Typewriter centré, indépendant (n'affecte pas la mise en page) */
    .typewriter-wrap{
      position:absolute;
      left:50%;
      transform:translateX(-50%);
      width:min(90vw, 720px);
      text-align:center;
      pointer-events:none; /* pour ne pas bloquer les clics du menu */
    }
    .typewriter{
      display:inline-block;
      color:#fff;
      font-weight:bold;
      font-size: clamp(16px, 2.4vw, 22px);
      white-space:nowrap;
      overflow:hidden;
      border-right: 2px solid rgba(255,255,255,.9);
      padding-right:6px;
    }

    /* ===== Menu desktop ===== */
    .menu{
      display:flex;
      align-items:center;
      gap:10px;
    }
    .btn{
      border:none;
      border-radius:8px;
      padding:10px 16px;
      background:#fff;
      color:var(--brand);
      font-weight:700;
      cursor:pointer;
      transition: transform .05s ease, background .25s ease, box-shadow .25s ease;
      box-shadow: 0 1px 3px rgba(0,0,0,.12);
    }
    .btn:hover{ background:#e9eef8; }
    .btn:active{ transform: translateY(1px); }
    .btn-ghost{
      background:transparent;
      color:#fff;
      box-shadow:none;
      border:1px solid rgba(255,255,255,.35);
    }
    .btn-ghost:hover{
      background: rgba(255,255,255,.12);
    }
    .btn-cta{
      background: var(--cta);
      color:#fff;
      border:none;
    }
    .btn-cta:hover{ background: var(--cta-dark); }

    /* Séparateur léger entre menu texte et CTA */
    .divider{
      width:1px; height:22px;
      background:rgba(255,255,255,.35);
      margin:0 6px;
    }

    /* ===== Burger (mobile) ===== */
    .burger{
      display:none; /* caché sur desktop */
      font-size:26px;
      line-height:1;
      background:none;
      border:none;
      color:#fff;
      cursor:pointer;
      padding:8px 10px;
      margin-left:8px;
    }

    /* ===== Dropdown mobile ===== */
    .dropdown{
      position:fixed;
      right:12px;
      top:calc(var(--header-h) + 8px);
      width:min(88vw, 360px);
      background: rgba(66,103,178,0.98);
      border-radius:12px;
      overflow:hidden;
      max-height:0;
      opacity:0;
      transition:max-height .4s ease, opacity .35s ease;
      box-shadow: 0 8px 24px rgba(0,0,0,.25);
      z-index:1100;
    }
    .dropdown.show{
      max-height:90vh;
      opacity:1;
    }
    .dropdown .item{
      display:block;
      width:100%;
      text-align:center;
      padding:16px 14px;
      background:none;
      border:none;
      color:#fff;
      font-size:18px;
      font-weight:700;
      cursor:pointer;
      border-bottom:1px solid rgba(255,255,255,.18);
    }
    .dropdown .item:last-child{ border-bottom:none; }
    .dropdown .item:hover{
      background: rgba(255,255,255,.10);
    }
    .dropdown .item.cta{
      background: var(--cta);
    }
    .dropdown .item.cta:hover{
      background: var(--cta-dark);
    }

    /* ===== Page content ===== */
    main{
      padding: calc(var(--header-h) + 24px) 16px 40px; /* espace sous le header fixe */
      max-width: 900px;
      margin: 0 auto;
    }
    .card{
      background: rgba(255,255,255,.94);
      border-radius:12px;
      padding:20px;
      box-shadow: 0 8px 24px rgba(0,0,0,.18);
      margin-bottom:22px;
      backdrop-filter: blur(3px);
    }
    h2{ margin:0 0 12px 0; }
    form{ display:flex; flex-direction:column; gap:12px; }
    input, textarea{
      padding:12px 14px;
      border:1px solid #d8dbe3;
      border-radius:8px;
      font-size:16px;
      background:#fff;
    }
    .err{ color:#e53935; font-size:14px; min-height:18px; }
    .post{ padding:12px 0; border-bottom:1px solid #e6e8ef; }
    .post:last-child{ border-bottom:none; }
    .post .auteur{ font-weight:700; color:var(--brand); margin-bottom:4px; }

    /* ===== Responsive ===== */
    @media (max-width: 900px){
      .btn{ padding:10px 14px; }
    }
    @media (max-width: 780px){
      .menu{ display:none; }     /* cache le menu desktop */
      .burger{ display:block; }  /* montre le burger */
    }
    /* Gros boutons sur mobile (dropdown) + zones de clic confortables */
    @media (max-width: 480px){
      .dropdown .item{ padding:18px 16px; font-size:19px; }
      .btn{ font-size:15px; }
    }
  </style>
</head>
<body>

  <!-- ===== Header fixe ===== -->
  <header>
    <!-- Typewriter centré, indépendant -->
    <div class="typewriter-wrap">
      <div class="typewriter" id="typewriter"></div>
    </div>

    <!-- Menu desktop à droite -->
    <nav class="menu" aria-label="Navigation principale">
      <button class="btn btn-ghost" onclick="scrollToId('accueil')">Accueil</button>
      <button class="btn btn-ghost" onclick="scrollToId('projet')">Projet</button>
      <button class="btn btn-ghost" onclick="scrollToId('organisation')">Organisation</button>
      <span class="divider" aria-hidden="true"></span>
      <button class="btn btn-cta" onclick="location.href='inscription.html'">S’inscrire</button>
    </nav>

    <!-- Burger (mobile) -->
    <button class="burger" aria-label="Ouvrir le menu" aria-expanded="false" onclick="toggleDropdown(event)">⋮</button>

    <!-- Dropdown mobile -->
    <div id="dropdown" class="dropdown" role="menu" aria-hidden="true">
      <button class="item" onclick="closeDropdown(); scrollToId('accueil')">Accueil</button>
      <button class="item" onclick="closeDropdown(); scrollToId('projet')">Projet</button>
      <button class="item" onclick="closeDropdown(); scrollToId('organisation')">Organisation</button>
      <button class="item cta" onclick="closeDropdown(); location.href='inscription.html'">S’inscrire</button>
    </div>
  </header>

  <!-- ===== Contenu ===== -->
  <main>
    <section id="accueil" class="card">
      <h2>Connexion</h2>
      <form id="loginForm">
        <input type="email" id="email" placeholder="Email" required />
        <input type="password" id="password" placeholder="Mot de passe" required />
        <div class="err" id="loginErr"></div>
        <button type="submit" class="btn btn-cta" style="align-self:flex-start;">Se connecter</button>
      </form>
      <div style="margin-top:10px;">
        <button class="btn" onclick="location.href='inscription.html'">S’inscrire</button>
      </div>
    </section>

    <section id="projet" class="card">
      <h2>Publier un post</h2>
      <form id="postForm">
        <input type="text" id="author" placeholder="Votre nom" required />
        <textarea id="content" placeholder="Qu'avez-vous à partager ?" rows="3" required></textarea>
        <div class="err" id="postErr"></div>
        <button type="submit" class="btn btn-cta" style="align-self:flex-start;">Publier</button>
      </form>
    </section>

    <section id="organisation" class="card">
      <h2>Fil d’actualité</h2>
      <div id="feed"></div>
    </section>
  </main>

  <script>
    // ===== Typewriter (boucle) =====
    const phrases = [
      "Bienvenue",
      "Partage tes idées.",
      "Systeme Ivoirien"
    ];
    const tw = document.getElementById('typewriter');
    let p = 0, i = 0, del = false;

    function stepType(){
      const text = phrases[p];
      if(!del){
        tw.textContent = text.slice(0, i++);
        if(i > text.length + 5){ del = true; }
      }else{
        tw.textContent = text.slice(0, i--);
        if(i < 0){ del = false; p = (p+1) % phrases.length; }
      }
      setTimeout(stepType, del ? 50 : 90);
    }
    stepType();

    // ===== Menu mobile =====
    const dropdown = document.getElementById('dropdown');
    const burgerBtn = document.querySelector('.burger');

    function toggleDropdown(e){
      e.stopPropagation();
      const show = !dropdown.classList.contains('show');
      dropdown.classList.toggle('show', show);
      dropdown.setAttribute('aria-hidden', show ? 'false' : 'true');
      burgerBtn.setAttribute('aria-expanded', show ? 'true' : 'false');
    }
    function closeDropdown(){
      dropdown.classList.remove('show');
      dropdown.setAttribute('aria-hidden', 'true');
      burgerBtn.setAttribute('aria-expanded', 'false');
    }
    // ferme au clic extérieur
    document.addEventListener('click', (e)=>{
      if(!dropdown.contains(e.target) && !burgerBtn.contains(e.target)){
        closeDropdown();
      }
    });
    // ferme avec Échap
    document.addEventListener('keydown', (e)=>{
      if(e.key === 'Escape'){ closeDropdown(); }
    });

    // ===== Navigation interne douce =====
    function scrollToId(id){
      const el = document.getElementById(id);
      if(!el) return;
      const y = el.getBoundingClientRect().top + window.scrollY - (parseInt(getComputedStyle(document.documentElement).getPropertyValue('--header-h')) + 8);
      window.scrollTo({ top: y, behavior: 'smooth' });
    }

    // ===== Backend calls =====
    const backendURL = 'https://ieslecampus.onrender.com';

    // Connexion
    const loginForm = document.getElementById('loginForm');
    const loginErr = document.getElementById('loginErr');
    loginForm.addEventListener('submit', async (e)=>{
      e.preventDefault();
      loginErr.textContent = '';
      const email = document.getElementById('email').value.trim();
      const password = document.getElementById('password').value.trim();

      if(!email.includes('@')){ loginErr.textContent = "Adresse email invalide."; return; }
      if(password.length < 6){ loginErr.textContent = "Le mot de passe doit contenir au moins 6 caractères."; return; }

      try{
        const r = await fetch(`${backendURL}/login`, {
          method:'POST',
          headers:{'Content-Type':'application/json'},
          body: JSON.stringify({ email, password })
        });
        const data = await r.json().catch(()=>({}));
        if(!r.ok || !data.success){
          loginErr.textContent = (data && data.message) ? data.message : "Erreur lors de la connexion.";
          return;
        }
        alert(`Connexion réussie pour ${email}`);
        loginForm.reset();
      }catch(err){
        loginErr.textContent = "Erreur réseau ou serveur indisponible.";
      }
    });

    // Posts
    const postForm = document.getElementById('postForm');
    const postErr = document.getElementById('postErr');
    const feed = document.getElementById('feed');

    async function loadPosts(){
      try{
        const r = await fetch(`${backendURL}/posts`);
        if(!r.ok) throw new Error("HTTP");
        const posts = await r.json();
        feed.innerHTML = '';
        if(!Array.isArray(posts) || posts.length===0){
          feed.innerHTML = '<p style="margin:0;opacity:.85;">Aucun post pour le moment.</p>';
          return;
        }
        posts.forEach(post=>{
          const wrap = document.createElement('div');
          wrap.className = 'post';
          wrap.innerHTML = `<div class="auteur">${post.author || 'Anonyme'}</div>
                            <div>${post.content || ''}</div>`;
          feed.appendChild(wrap);
        });
      }catch(err){
        feed.innerHTML = '<p style="margin:0;color:#e53935;">Impossible de charger le fil d’actualité.</p>';
      }
    }

    postForm.addEventListener('submit', async (e)=>{
      e.preventDefault();
      postErr.textContent = '';
      const author = document.getElementById('author').value.trim();
      const content = document.getElementById('content').value.trim();
      if(!author || !content){ postErr.textContent = "Veuillez remplir tous les champs."; return; }

      try{
        const r = await fetch(`${backendURL}/posts`, {
          method:'POST',
          headers:{'Content-Type':'application/json'},
          body: JSON.stringify({ author, content })
        });
        const data = await r.json().catch(()=>({}));
        if(!r.ok || !data.success){
          postErr.textContent = (data && data.message) ? data.message : "Erreur lors de la publication.";
          return;
        }
        postForm.reset();
        loadPosts();
      }catch(err){
        postErr.textContent = "Erreur réseau ou serveur indisponible.";
      }
    });

    // Charger les posts au démarrage
    loadPosts();
  </script>
</body>
</html>
