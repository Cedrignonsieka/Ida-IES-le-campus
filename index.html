<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Mini Réseau Social - Accueil</title>
  <style>
    body {
      font-family: 'Courier New', Courier, monospace; /* machine à écrire */
      background: url("im.jpg") no-repeat center center fixed;
      background-size: cover;
      margin: 0;
      padding: 0;
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    /* Header flottant */
    header {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      background-color: rgba(66, 103, 178, 0.9);
      color: white;
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 10px 20px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.2);
      z-index: 1000;
    }

    .typewriter-container {
      flex-grow: 1;
      overflow: hidden;
    }

    .typewriter h1 {
      font-size: 22px;
      border-right: 2px solid white;
      white-space: nowrap;
      overflow: hidden;
      margin: 0;
    }

    /* Menu boutons */
    .menu-container {
      display: flex;
      align-items: center;
      gap: 15px;
    }

    .menu-container button {
      background-color: #42b72a;
      border: none;
      padding: 10px 20px;
      border-radius: 8px;
      color: white;
      font-weight: bold;
      cursor: pointer;
      transition: all 0.3s ease;
      box-shadow: 0 4px 0 #2f8a1e, 0 6px 10px rgba(0,0,0,0.2);
    }

    .menu-container button:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 0 #2f8a1e, 0 8px 12px rgba(0,0,0,0.2);
    }

    /* Menu burger mobile */
    .burger {
      display: none;
      font-size: 28px;
      cursor: pointer;
      background: none;
      border: none;
      color: white;
    }

    .dropdown {
      display: none;
      position: absolute;
      right: 20px;
      top: 50px;
      background-color: rgba(66,103,178,0.95);
      border-radius: 8px;
      overflow: hidden;
      flex-direction: column;
    }

    .dropdown button {
      width: 100%;
      padding: 15px;
      font-size: 18px;
      text-align: center;
      border-bottom: 1px solid rgba(255,255,255,0.2);
      box-shadow: none;
    }

    .dropdown button:last-child {
      border-bottom: none;
    }

    /* Conteneurs principaux */
    .container {
      max-width: 600px;
      margin-top: 100px; /* espace sous le header flottant */
      background: rgba(255, 255, 255, 0.9);
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.2);
      width: 90%;
    }

    h2 {
      margin-top: 0;
    }

    form {
      display: flex;
      flex-direction: column;
      margin-bottom: 20px;
    }

    input, textarea {
      padding: 10px;
      margin: 6px 0 12px 0;
      border: 1px solid #ccc;
      border-radius: 4px;
      font-size: 16px;
      resize: vertical;
    }

    button.submit-btn {
      padding: 10px;
      background-color: #4267B2;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-size: 16px;
      transition: all 0.3s ease;
      box-shadow: 0 4px 0 #365899, 0 6px 10px rgba(0,0,0,0.2);
    }

    button.submit-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 0 #365899, 0 8px 12px rgba(0,0,0,0.2);
    }

    .error {
      color: red;
      font-size: 14px;
      margin-bottom: 12px;
    }

    .success {
      color: green;
      font-size: 14px;
      margin-bottom: 12px;
    }

    /* Responsive */
    @media (max-width: 600px) {
      .menu-container {
        display: none;
      }
      .burger {
        display: block;
      }
      .dropdown {
        top: 50px;
        right: 10px;
      }
      .dropdown button {
        font-size: 20px;
        padding: 18px 10px;
      }
    }
  </style>
</head>
<body>

  <header>
    <div class="typewriter-container">
      <h1 id="animatedTitle"></h1>
    </div>

    <div class="menu-container">
      <button>ACCUEIL</button>
      <button>PROJET</button>
      <button>ORGANISATION</button>
    </div>

    <button class="burger" onclick="toggleDropdown()">☰</button>
    <div class="dropdown" id="dropdownMenu">
      <button>ACCUEIL</button>
      <button>PROJET</button>
      <button>ORGANISATION</button>
    </div>
  </header>

  <div class="container">
    <h2>Connexion</h2>
    <form id="loginForm">
      <input type="email" id="email" placeholder="Email" required />
      <input type="password" id="password" placeholder="Mot de passe" required />
      <div class="error" id="errorMsg"></div>
      <button type="submit" class="submit-btn">Se connecter</button>
    </form>
    <button class="menu-container" onclick="window.location.href='inscription.html'" style="background-color:#42b72a;">S’inscrire</button>
  </div>

  <div class="container" style="margin-top: 20px;">
    <h2>Publier un post</h2>
    <form id="postForm">
      <input type="text" id="author" placeholder="Votre nom" required />
      <textarea id="content" placeholder="Qu'avez-vous à partager ?" rows="3" required></textarea>
      <div class="error" id="postErrorMsg"></div>
      <button type="submit" class="submit-btn">Publier</button>
    </form>
  </div>

  <div class="container" style="margin-top: 20px;">
    <h2>Fil d’actualité</h2>
    <div id="feed"></div>
  </div>

  <script>
    const backendURL = 'https://ieslecampus.onrender.com';

    // Typewriter animation
    const titleElement = document.getElementById('animatedTitle');
    const phrases = [
      "Mini Réseau Social",
      "Partage tes pensées",
      "Connecte-toi avec tes amis",
      "Exprime-toi librement",
      "Bienvenue dans ta communauté"
    ];
    let phraseIndex = 0, charIndex = 0, isDeleting = false;

    function typeWriter() {
      const currentPhrase = phrases[phraseIndex];
      const displayedText = isDeleting
        ? currentPhrase.substring(0, charIndex--)
        : currentPhrase.substring(0, charIndex++);
      titleElement.textContent = displayedText;
      if (!isDeleting && charIndex === currentPhrase.length + 1) { isDeleting = true; setTimeout(typeWriter,1200); return; }
      if (isDeleting && charIndex === 0) { isDeleting=false; phraseIndex=(phraseIndex+1)%phrases.length; }
      const speed = isDeleting ? 50 : 100;
      setTimeout(typeWriter, speed);
    }
    typeWriter();

    // Toggle dropdown
    function toggleDropdown() {
      const dropdown = document.getElementById('dropdownMenu');
      dropdown.style.display = dropdown.style.display === 'flex' ? 'none' : 'flex';
    }

    // Gestion Connexion
    const loginForm = document.getElementById('loginForm');
    const errorMsg = document.getElementById('errorMsg');
    loginForm.addEventListener('submit', async function(event){
      event.preventDefault();
      errorMsg.textContent = '';
      const email = loginForm.email.value.trim();
      const password = loginForm.password.value.trim();
      if (!email.includes('@')) { errorMsg.textContent="Adresse email invalide."; return; }
      if (password.length<6){ errorMsg.textContent="Le mot de passe doit contenir au moins 6 caractères."; return; }
      try{
        const response = await fetch(`${backendURL}/login`,{
          method:'POST', headers:{'Content-Type':'application/json'}, body:JSON.stringify({email,password})
        });
        if(!response.ok){ const errData = await response.json(); errorMsg.textContent = errData.message || 'Erreur lors de la connexion.'; return; }
        const data = await response.json();
        if(data.success){ alert(`Connexion réussie pour ${email}`); loginForm.reset(); errorMsg.textContent=''; }
        else { errorMsg.textContent=data.message || "Erreur lors de la connexion."; }
      } catch(err){ errorMsg.textContent="Erreur réseau ou serveur indisponible."; }
    });

    // Gestion Post
    const postForm = document.getElementById('postForm');
    const postErrorMsg = document.getElementById('postErrorMsg');
    const feed = document.getElementById('feed');

    async function loadPosts() {
      try{
        const response = await fetch(`${backendURL}/posts`);
        if(!response.ok) throw new Error("Erreur serveur");
        const posts = await response.json();
        feed.innerHTML='';
        posts.forEach(post=>{
          const postDiv=document.createElement('div');
          postDiv.classList.add('post');
          const authorDiv=document.createElement('div');
          authorDiv.classList.add('post-author'); authorDiv.textContent=post.author;
          const contentDiv=document.createElement('div');
          contentDiv.classList.add('post-content'); contentDiv.textContent=post.content;
          postDiv.appendChild(authorDiv); postDiv.appendChild(contentDiv); feed.appendChild(postDiv);
        });
      } catch(err){ feed.innerHTML='<p>Impossible de charger le fil d’actualité.</p>'; }
    }

    postForm.addEventListener('submit', async function(event){
      event.preventDefault(); postErrorMsg.textContent='';
      const author=document.getElementById('author').value.trim();
      const content=document.getElementById('content').value.trim();
      if(author===''||content===''){ postErrorMsg.textContent="Veuillez remplir tous les champs."; return; }
      try{
        const response=await fetch(`${backendURL}/posts`,{
          method:'POST', headers:{'Content-Type':'application/json'}, body:JSON.stringify({author,content})
        });
        if(!response.ok){ const errData=await response.json(); postErrorMsg.textContent=errData.message || "Erreur lors de la publication."; return; }
        const data=await response.json();
        if(data.success){ postForm.reset(); await loadPosts(); }
        else{ postErrorMsg.textContent=data.message || "Erreur lors de la publication."; }
      } catch(err){ postErrorMsg.textContent="Erreur réseau ou serveur indisponible."; }
    });

    loadPosts();
  </script>
</body>
</html>
